---
sidebar: sidebar 
permalink: solutions/cvo-azure-burst-to-cloud.html 
keywords: bluexp automation hub, netapp automation solutions, azure, cloud volumes ontap, burst to cloud. netapp, console 
summary: VocÃª pode usar essa soluÃ§Ã£o de automaÃ§Ã£o para implantar o Cloud Volumes ONTAP para Azure usando o Terraform. 
---
= Cloud Volumes ONTAP para Azure - Burst para a nuvem
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Este artigo oferece suporte Ã  soluÃ§Ã£o NetApp Cloud Volumes ONTAP para Azure Automation, disponÃ­vel para clientes NetApp no â€‹â€‹hub de automaÃ§Ã£o do NetApp Console .

A soluÃ§Ã£o de automaÃ§Ã£o do Cloud Volumes ONTAP para Azure automatiza a implantaÃ§Ã£o em contÃªiner do Cloud Volumes ONTAP para Azure usando o Terraform, permitindo que vocÃª implante o Cloud Volumes ONTAP para Azure rapidamente, sem qualquer intervenÃ§Ã£o manual.

.Antes de comeÃ§ar
* VocÃª precisa baixar o link:https://console.netapp.com/automationHub["Cloud Volumes ONTAP Azure - Burst para a nuvem"^] SoluÃ§Ã£o de automaÃ§Ã£o atravÃ©s da interface web do Console. A soluÃ§Ã£o Ã© empacotada como `CVO-Azure-Burst-To-Cloud.zip`.
* VocÃª deve instalar uma VM Linux na mesma rede que o Cloud Volumes ONTAP.
* Depois de instalar a VM Linux, vocÃª deve seguir as etapas desta soluÃ§Ã£o para instalar as dependÃªncias necessÃ¡rias.




== Passo 1: Instale o Docker e o Docker Compose



=== Instale o Docker

As etapas a seguir usam o software de distribuiÃ§Ã£o Debian Linux Ubuntu 20,04 como exemplo. Os comandos que vocÃª executa dependem do software de distribuiÃ§Ã£o Linux que vocÃª estÃ¡ usando. Consulte a documentaÃ§Ã£o especÃ­fica do software de distribuiÃ§Ã£o Linux para sua configuraÃ§Ã£o.

.Passos
. Instale o Docker executando os `sudo` seguintes comandos:
+
[source, cli]
----
sudo apt-get update
sudo apt-get install apt-transport-https cacertificates curl gnupg-agent software-properties-common curl -fsSL https://download.docker.com/linux/ubuntu/gpg |
sudo apt-key add -
sudo add-apt-repository â€œdeb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stableâ€
sudo apt-get update
sudo apt-get install dockerce docker-ce-cli containerd.io
----
. Verifique a instalaÃ§Ã£o:
+
[source, cli]
----
docker â€“version
----
. Verifique se um grupo chamado "docker" foi criado em seu sistema Linux. Se necessÃ¡rio, crie o grupo:
+
[source, cli]
----
sudo groupadd docker
----
. Adicione o usuÃ¡rio que precisa acessar o Docker ao grupo:
+
[source, cli]
----
sudo usermod -aG docker $(whoami)
----
. As alteraÃ§Ãµes sÃ£o aplicadas depois de terminar sessÃ£o e voltar a iniciar sessÃ£o no terminal. Alternativamente, vocÃª pode aplicar as alteraÃ§Ãµes imediatamente:
+
[source, cli]
----
newgrp docker
----




=== Instale o Docker Compose

.Passos
. Instale o Docker Compose executando os seguintes `sudo` comandos:
+
[source, cli]
----
sudo curl -L â€œhttps://github.com/docker/compose/releases/download/1.29.2/dockercompose-(ğ‘¢ğ‘›ğ‘ğ‘šğ‘’ âˆ’ ğ‘ )âˆ’(uname -m)â€ -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
----
. Verifique a instalaÃ§Ã£o:
+
[source, cli]
----
docker-compose â€“version
----




== Passo 2: Prepare a imagem do Docker

.Passos
. Copie a `CVO-Azure-Burst-To-Cloud.zip` pasta para a VM Linux que vocÃª deseja usar para implantar o Cloud Volumes ONTAP:
+
[source, cli]
----
scp -i ~/<private-key>.pem -r CVO-Azure-Burst-To-Cloud.zip <azureuser>@<IP_ADDRESS_OF_VM>:<LOCATION_TO_BE_COPIED>
----
+
** `private-key.pem` Ã© o seu arquivo de chave privada para login sem uma senha.
** `azureuser` Ã‰ o nome de usuÃ¡rio da VM.
** `IP_ADDRESS_OF_VM` Ã‰ o endereÃ§o IP da VM.
** `LOCATION_TO_BE_COPIED` Ã© o local onde a pasta serÃ¡ copiada.


. Extraia a `CVO-Azure-Burst-To-Cloud.zip` pasta. VocÃª pode extrair a pasta no diretÃ³rio atual ou em um local personalizado.
+
Para extrair a pasta no diretÃ³rio atual, execute:

+
[source, cli]
----
unzip CVO-Azure-Burst-To-Cloud.zip
----
+
Para extrair a pasta em um local personalizado, execute:

+
[source, cli]
----
unzip CVO-Azure-Burst-To-Cloud.zip -d ~/<your_folder_name>
----
. Depois de extrair o conteÃºdo, navegue atÃ© `CVO_Azure_Deployment` a pasta e execute o seguinte comando para visualizar os arquivos:
+
[source, cli]
----
 ls -la
----
+
VocÃª deve ver uma lista de arquivos, semelhante ao seguinte exemplo:

+
[listing]
----
drwxr-xr-x@ 11 user1 staff 352 May 5 13:56 .
drwxr-xr-x@ 5 user1 staff 160 May 5 14:24 ..
-rw-r--r--@ 1 user1 staff 324 May 5 13:18 .env
-rw-r--r--@ 1 user1 staff 1449 May 5 13:18 Dockerfile
-rw-r--r--@ 1 user1 staff 35149 May 5 13:18 LICENSE
-rw-r--r--@ 1 user1 staff 13356 May 5 14:26 README.md
-rw-r--r-- 1  user1 staff 354318151 May 5 13:51 cvo_azure_flexcache_ubuntu_image_latest
drwxr-xr-x@ 4 user1 staff 128 May 5 13:18 cvo_azure_variables
-rw-r--r--@ 1 user1 staff 996 May 5 13:18 docker-compose-deploy.yml
-rw-r--r--@ 1 user1 staff 1041 May 5 13:18 docker-compose-destroy.yml
-rw-r--r--@ 1 user1 staff 4771 May 5 13:18 sp_role.json
----
. Localize o `cvo_azure_flexcache_ubuntu_image_latest.tar.gz` arquivo. Isso contÃ©m a imagem Docker necessÃ¡ria para implantar o Cloud Volumes ONTAP para Azure.
. Descomprimir o ficheiro:
+
[source, cli]
----
docker load -i cvo_azure_flexcache_ubuntu_image_latest.tar.gz
----
. Aguarde alguns minutos para que a imagem do Docker seja carregada e, em seguida, valide que a imagem do Docker foi carregada com sucesso:
+
[source, cli]
----
docker images
----
+
VocÃª deve ver uma imagem Docker chamada `cvo_azure_flexcache_ubuntu_image_latest` com a `latest` tag, como mostrado no exemplo a seguir:

+
[listing]
----
REPOSITORY TAG IMAGE ID CREATED SIZE
cvo_azure_flexcache_ubuntu_image latest 18db15a4d59c 2 weeks ago 1.14GB
----




== Passo 3: Criar arquivos variÃ¡veis de ambiente

Nesta fase, vocÃª deve criar dois arquivos de variÃ¡veis de ambiente.  Um arquivo Ã© para autenticaÃ§Ã£o de APIs do Azure Resource Manager usando credenciais de entidade de serviÃ§o.  O segundo arquivo serve para definir variÃ¡veis de ambiente para permitir que os mÃ³dulos do Console Terraform localizem e autentiquem as APIs do Azure.

.Passos
. Crie um responsÃ¡vel de serviÃ§o.
+
Antes de criar os arquivos variÃ¡veis de ambiente, vocÃª deve criar um princÃ­pio de serviÃ§o seguindo as etapas em link:https://learn.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal["Crie um diretor de serviÃ§o e aplicativo do Azure ative Directory que possa acessar recursos"^].

. Atribua a funÃ§Ã£o *Colaborador* ao responsÃ¡vel de serviÃ§o recÃ©m-criado.
. Crie uma funÃ§Ã£o personalizada.
+
.. Localize o `sp_role.json` arquivo e verifique as permissÃµes necessÃ¡rias nas aÃ§Ãµes listadas.
.. Insira essas permissÃµes e anexe a funÃ§Ã£o personalizada ao responsÃ¡vel de serviÃ§o recÃ©m-criado.


. Navegue atÃ© *certificados e segredos* e selecione *segredo de novo cliente* para criar o segredo do cliente.
+
Quando vocÃª cria o segredo do cliente, vocÃª deve Registrar os detalhes da coluna *valor* porque vocÃª nÃ£o serÃ¡ capaz de ver esse valor novamente. VocÃª tambÃ©m deve Registrar as seguintes informaÃ§Ãµes:

+
** ID do cliente
** ID da subscriÃ§Ã£o
** ID do inquilino
+
VocÃª precisarÃ¡ dessas informaÃ§Ãµes para criar as variÃ¡veis de ambiente. VocÃª pode encontrar informaÃ§Ãµes de ID de cliente e ID de locatÃ¡rio na seÃ§Ã£o *VisÃ£o geral* da IU do ServiÃ§o Principal.



. Crie os arquivos de ambiente.
+
.. Crie o `azureauth.env` arquivo no seguinte local:
+
`path/to/env-file/azureauth.env`

+
... Adicione o seguinte conteÃºdo ao arquivo:
+
A Sony Computer Entertainment Europe Ã© uma das nossas principais empresas de tecnologia de ponta

+
O formato *deve* ser exatamente como mostrado acima, sem espaÃ§os entre a chave e o valor.



.. Crie o `credentials.env` arquivo no seguinte local:
+
`path/to/env-file/credentials.env`

+
... Adicione o seguinte conteÃºdo ao arquivo:
+
AZURE_CLIENT_ID_ID_AZURE_CLIENT_SECRET_ID_AZURE_CLIENT_ID

+
O formato *deve* ser exatamente como mostrado acima, sem espaÃ§os entre a chave e o valor.





. Adicione os caminhos de arquivo absolutos ao `.env` arquivo.
+
Insira o caminho absoluto para o `azureauth.env` arquivo de ambiente no `.env` arquivo que corresponde Ã  `AZURE_RM_CREDS` variÃ¡vel de ambiente.

+
`AZURE_RM_CREDS=path/to/env-file/azureauth.env`

+
Insira o caminho absoluto para o `credentials.env` arquivo de ambiente no `.env` arquivo que corresponde Ã  `BLUEXP_TF_AZURE_CREDS` variÃ¡vel de ambiente.

+
`BLUEXP_TF_AZURE_CREDS=path/to/env-file/credentials.env`





== Etapa 4: inscreva-se no NetApp Intelligent Services

Inscreva-se no NetApp Intelligent Services por meio do seu provedor de nuvem para pagar por hora (PAYGO) ou por meio de um contrato anual. Os serviÃ§os inteligentes da NetApp incluem backup e recuperaÃ§Ã£o da NetApp , Cloud Volumes ONTAP, NetApp Cloud Tiering, NetApp Ransomware Resilience e NetApp Disaster Recovery. A classificaÃ§Ã£o de dados da NetApp estÃ¡ incluÃ­da na sua assinatura sem custo adicional

.Passos
. No portal do Azure, navegue atÃ© *SaaS* e selecione *Assinar o NetApp Intelligent Services*.
. Selecione o plano *Cloud Manager (por Cap PYGO por hora, WORM e serviÃ§os de dados)*.
+
VocÃª pode usar o mesmo grupo de recursos que o Cloud Volumes ONTAP ou um grupo de recursos diferente.

. Configure o portal do Console para importar a assinatura SaaS para o Console.
+
VocÃª pode configurar isso diretamente no portal do Azure navegando atÃ© *Detalhes do produto e do plano* e selecionando a opÃ§Ã£o *Configurar conta agora*.

+
VocÃª serÃ¡ redirecionado ao portal do Console para confirmar a configuraÃ§Ã£o.

. Confirme a configuraÃ§Ã£o no portal do Console selecionando *Salvar*.




== Passo 5: Crie um volume externo

VocÃª deve criar um volume externo para manter os arquivos de estado do Terraform e outros arquivos importantes persistentes. VocÃª deve garantir que os arquivos estejam disponÃ­veis para o Terraform para executar o fluxo de trabalho e as implantaÃ§Ãµes.

.Passos
. Criar um volume externo fora do Docker Compose:
+
[source, cli]
----
docker volume create Â« volume_name Â»
----
+
Exemplo:

+
[listing]
----
docker volume create cvo_azure_volume_dst
----
. Use uma das seguintes opÃ§Ãµes:
+
.. Adicione um caminho de volume externo ao `.env` arquivo de ambiente.
+
VocÃª deve seguir o formato exato mostrado abaixo.

+
Formato:

+
`PERSISTENT_VOL=path/to/external/volume:/cvo_azure`

+
Exemplo:
`PERSISTENT_VOL=cvo_azure_volume_dst:/cvo_azure`

.. Adicionar compartilhamentos NFS como volume externo.
+
Certifique-se de que o contentor Docker possa se comunicar com os compartilhamentos NFS e que as permissÃµes corretas, como leitura/gravaÃ§Ã£o, estejam configuradas.

+
... Adicione o caminho de compartilhamentos NFS como caminho para o volume externo no arquivo Docker Compose, como mostrado abaixo: Formato:
+
`PERSISTENT_VOL=path/to/nfs/volume:/cvo_azure`

+
Exemplo:
`PERSISTENT_VOL=nfs/mnt/document:/cvo_azure`





. Navegue atÃ© `cvo_azure_variables` a pasta.
+
VocÃª deve ver os seguintes arquivos variÃ¡veis na pasta:

+
`terraform.tfvars`

+
`variables.tf`

. Altere os valores dentro do `terraform.tfvars` arquivo de acordo com suas necessidades.
+
VocÃª deve ler a documentaÃ§Ã£o de suporte especÃ­fica ao modificar qualquer um dos valores de variÃ¡vel no `terraform.tfvars` arquivo. Os valores podem variar dependendo da regiÃ£o, zonas de disponibilidade e outros fatores suportados pelo Cloud Volumes ONTAP para Azure. Isso inclui licenÃ§as, tamanho de disco e tamanho de VM para nÃ³s Ãºnicos e pares de alta disponibilidade (HA).

+
Todas as variÃ¡veis â€‹â€‹de suporte para o agente do Console e os mÃ³dulos Terraform do Cloud Volumes ONTAP jÃ¡ estÃ£o definidas no `variables.tf` arquivo.  VocÃª deve se referir aos nomes das variÃ¡veis â€‹â€‹no `variables.tf` arquivo antes de adicionar ao `terraform.tfvars` arquivo.

. Dependendo dos seus requisitos, pode ativar ou desativar o FlexCache e o FlexClone definindo as seguintes opÃ§Ãµes para `true` ou `false`.
+
Os exemplos a seguir habilitam o FlexCache e o FlexClone:

+
** `is_flexcache_required = true`
** `is_flexclone_required = true`


. Se necessÃ¡rio, vocÃª pode recuperar o valor da variÃ¡vel Terraform `az_service_principal_object_id` no ServiÃ§o do Azure ative Directory:
+
.. Navegue atÃ© *Enterprise Applications â€“> All Applications* (aplicaÃ§Ãµes empresariais) e selecione o nome do Service Principal que criou anteriormente.
.. Copie o ID do objeto e insira o valor da variÃ¡vel Terraform:
+
`az_service_principal_object_id`







== Etapa 6: Implante o Cloud Volumes ONTAP para Azure

Siga as etapas a seguir para implantar o Cloud Volumes ONTAP para Azure.

.Passos
. Na pasta raiz, execute o seguinte comando para acionar a implantaÃ§Ã£o:
+
[source, cli]
----
docker-compose up -d
----
+
Dois contÃªineres sÃ£o acionados, o primeiro contÃªiner implanta o Cloud Volumes ONTAP e o segundo contÃªiner envia dados de telemetria para o AutoSupport.

+
O segundo recipiente aguarda atÃ© que o primeiro recipiente conclua todas as etapas com Ãªxito.

. Monitore o progresso do processo de implantaÃ§Ã£o usando os arquivos de log:
+
[source, cli]
----
docker-compose logs -f
----
+
Este comando fornece saÃ­da em tempo real e captura os dados nos seguintes arquivos de log:

+
`deployment.log`

+
`telemetry_asup.log`

+
VocÃª pode alterar o nome desses arquivos de log editando o `.env` arquivo usando as seguintes variÃ¡veis de ambiente:

+
`DEPLOYMENT_LOGS`

+
`TELEMETRY_ASUP_LOGS`

+
Os exemplos a seguir mostram como alterar os nomes dos arquivos de log:

+
`DEPLOYMENT_LOGS=<your_deployment_log_filename>.log`

+
`TELEMETRY_ASUP_LOGS=<your_telemetry_asup_log_filename>.log`



.Depois de terminar
VocÃª pode usar as etapas a seguir para remover o ambiente temporÃ¡rio e limpar itens criados durante o processo de implantaÃ§Ã£o.

.Passos
. Se vocÃª implantou o FlexCache, defina a seguinte opÃ§Ã£o no `terraform.tfvars` arquivo, isso limpa os volumes do FlexCache e remove o ambiente temporÃ¡rio criado anteriormente.
+
`flexcache_operation = "destroy"`

+

NOTE: As opÃ§Ãµes possÃ­veis sÃ£o  `deploy` e `destroy`.

. Se vocÃª implantou o FlexClone, defina a seguinte opÃ§Ã£o no `terraform.tfvars` arquivo, isso limpa os volumes do FlexClone e remove o ambiente temporÃ¡rio criado anteriormente.
+
`flexclone_operation = "destroy"`

+

NOTE: As opÃ§Ãµes possÃ­veis sÃ£o `deploy` e `destroy`.


